{% extends "partials/base_slide_panel.html" %}

{% block slidePanel %}

<!-- Slot Template -->
<template x-if="panelMode === 'slots'">
    <div class="space-y-4">
        <!-- Slot Name -->
        <div>
            <label class="block mb-1 font-semibold">Slot Name</label>
            <input type="text"
                   x-model="slotForm.slot.name"
                   class="w-full p-2 border rounded border-base-border bg-base-surface text-base-text"
                   required>
        </div>

        <!-- Colour -->
        <div>
            <label class="block mb-1 font-semibold">Colour</label>
            <select x-model="slotForm.slot.colour" class="w-full p-2 border rounded border-base-border bg-base-surface text-base-text">
                <option value="-">-</option>
                <option value="Gold">Gold</option>
                <option value="Green">Green</option>
                <option value="Blue">Blue</option>
                <option value="Red">Red</option>
            </select>
        </div>

        <!-- Current Member (read-only) -->
        <div>
            <label class="block mb-1 font-semibold">Current Member</label>
            <input type="text"
                   :value="slotForm.slot.user_id ? members.find(m => m.id === slotForm.slot.user_id).name : ''"
                   class="w-full p-2 border rounded border-base-border bg-base-surface text-base-text"
                   readonly>
        </div>

        <!-- New Member (select) -->
        <div>
            <label class="block mb-1 font-semibold">Change / Assign Member</label>
            <select x-model="slotForm.new_user_id" class="w-full p-2 border rounded border-base-border bg-base-surface text-base-text">
                <option value="">— Select —</option>
                <template x-for="member in members" :key="member.id">
                    <option :value="member.id" x-text="member.name"></option>
                </template>
            </select>
        </div>

        <!-- Description -->
        <div>
            <label class="block mb-1 font-semibold">Description</label>
            <textarea x-model="slotForm.slot.description"
                      rows="3"
                      class="w-full p-2 border rounded border-base-border bg-base-surface text-base-text"></textarea>
        </div>

        <!-- Rank -->
        <div class="mb-4">
            <label class="block mb-1 font-semibold">Rank</label>
            <div class="flex items-center justify-between bg-base-surface p-2 rounded">
                <span x-text="slotForm.slot.rank ? slotForm.slot.rank.name : 'PVT'"></span>
                <button type="button" x-show="slotForm.slot.rank" @click="slotForm.removeRank()" class="text-red-500">
                    Remove
                </button>
            </div>
        </div>

        <!-- Roles -->
        <div class="mb-4">
            <label class="block mb-1 font-semibold">Roles</label>
            <ul class="space-y-1 mb-2">
                <template x-for="(roleItem, index) in slotForm.nonRankRoles" :key="roleItem.id">
                    <li class="flex justify-between items-center bg-base-surface p-2 rounded">
                        <span x-text="roleItem.name"></span>
                        <div class="space-x-1">
                            <button type="button" @click="slotForm.removeRole(index)" class="text-red-500">Remove</button>
                            <button type="button" @click="slotForm.moveUp(index)" :disabled="index===0">↑</button>
                            <button type="button" @click="slotForm.moveDown(index)" :disabled="index===slotForm.nonRankRoles.length-1">↓</button>
                        </div>
                    </li>
                </template>
            </ul>
        </div>

        <div>
            <label class="block mb-1 font-semibold">Add Role</label>
            <div class="flex space-x-2">
                <select x-model="slotForm.newRoleId" class="w-full p-2 border rounded border-base-border bg-base-surface text-base-text">
                    <option value="">— Select —</option>
                    <template x-for="r in slotForm.availableRoles" :key="r.id">
                        <option :value="r.id" x-text="r.name"></option>
                    </template>
                </select>
                <button type="button" @click="slotForm.addRole()" class="px-4 py-2 bg-green-500 text-white rounded">
                    Add
                </button>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end space-x-2 mt-4">
            <button type="button" @click="slotForm.saveSlot(); panelOpen=false" class="px-4 py-2 bg-base-accent text-white rounded">Save</button>
            <button type="button"
                    class="px-4 py-2 bg-red-500 text-white rounded"
                    x-show="slotForm.slot.id"
                    @click="if(confirm('Are you sure you want to delete this role?')) slotForm.deleteRole(); panelOpen = false">
                Delete
            </button>
        </div>
    </div>
</template>

<template x-if="panelMode === 'loa'">
    <form>
        <!-- LOA form fields -->
        <div class="mt-4 flex justify-end gap-2">
      <button @click="submitRoles()" class="px-4 py-2 bg-blue-500 text-white rounded">
        Save
      </button>
      <button @click="panelOpen = false" class="px-4 py-2 bg-gray-300 rounded">
        Cancel
      </button>
    </div>
    </form>
</template>

<template x-if="panelMode === 'join'">
    <form>
        <button type="submit" class="bg-green-500 px-4 py-2 rounded text-white">Submit</button>
        <button type="button" @click="panelOpen = false" class="ml-2 px-4 py-2 rounded border">Cancel</button>
    </form>
</template>

<template x-if="panelMode === 'leave'">
    <form>
        <!-- Leave section fields -->
    </form>
</template>

<template x-if="panelMode === 'section_management'">
    <div>
        <!-- Management controls -->
    </div>
</template>


{% endblock %}